# –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ DAG (Cross-DAG Dependencies)

–í —ç—Ç–æ–º —Å—Ç–µ–Ω–¥–µ –ø–∞–π–ø–ª–∞–π–Ω—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ DAG-–æ–≤ –ø–æ —Å–ª–æ—è–º DWH (STG, ODS, DDS, DM). 
–û–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å `schedule=None`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç.

–ß—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ—à–ª–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–æ –≤–∏—Ç—Ä–∏–Ω, –∑–∞–ø—É—Å–∫–∞—Ç—å DAG-–∏ –Ω—É–∂–Ω–æ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

## 1. DDL-—Å–∫—Ä–∏–ø—Ç—ã (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ—è—Ö:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `bookings_dds_ddl` ‚Äî —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏ —Ñ–∞–∫—Ç–æ–≤ –≤ —Å–ª–æ–µ DDS.
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `bookings_dm_ddl` ‚Äî —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –≤–∏—Ç—Ä–∏–Ω –≤ —Å–ª–æ–µ DM.

*(–°–ª–æ–∏ STG –∏ ODS —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å—Ç–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ `make ddl-gp` –∏–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ DDL-—Å–∫—Ä–∏–ø—Ç–∞–º–∏).*

## 2. –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (ETL)

–î–ª—è –ø—Ä–æ–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–π –ø–æ—Ä—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–∏–ª–∏ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç–∞) —Å–æ–±–ª—é–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Ü–µ–ø–æ—á–∫—É:

1. **`bookings_to_gp_stage`** 
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–µ–º–æ-–ë–î PostgreSQL –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ `stg`-—Å—Ö–µ–º—É –≤ Greenplum.
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `stg_batch_id` –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–≥—Ä—É–∑–∫–∏.
2. **`bookings_to_gp_ods`**
   - –ë–µ—Ä—ë—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π `stg_batch_id` –∏–∑ STG-—Å–ª–æ—è.
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏ SCD1-UPSERT –≤ —Å–ª–æ–π ODS.
3. **`bookings_to_gp_dds`**
   - –ß–∏—Ç–∞–µ—Ç –æ—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ ODS.
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–∑–º–µ—Ä–µ–Ω–∏—è (SCD1, SCD2) –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –¥–æ–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ —Ä–µ–π—Å—ã –≤ —Ç–∞–±–ª–∏—Ü—É —Ñ–∞–∫—Ç–æ–≤ `dds.fact_flight_sales`.
4. **`bookings_to_gp_dm`**
   - –ß–∏—Ç–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ DDS.
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏—Ç—Ä–∏–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç HWM-–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ `_load_ts` –∏–ª–∏ –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç).

> **üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞:** –í —Ä–µ–∞–ª—å–Ω–æ–º production-–æ–∫—Ä—É–∂–µ–Ω–∏–∏ (Airflow) —ç—Ç–∏ —Å–≤—è–∑–∏ –º–µ–∂–¥—É DAG-–∞–º–∏ –æ–±—ã—á–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `TriggerDagRunOperator`, `ExternalTaskSensor` –∏–ª–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã Data-Aware Scheduling (Datasets/Data Assets). –í —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö –º—ã –æ—Å—Ç–∞–≤–∏–ª–∏ –∏—Ö —Ä—É—á–Ω—ã–º–∏, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –ø—Ä–æ–∏–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª–æ–π –ø–æ—Å–ª–µ –µ–≥–æ –∑–∞–≥—Ä—É–∑–∫–∏.
